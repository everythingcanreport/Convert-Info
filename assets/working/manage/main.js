function getCookie(e){for(var a=e+"=",n=document.cookie.split(";"),t=0;t<n.length;t++){for(var i=n[t];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(a))return i.substring(a.length,i.length)}return""}function writeStories(){require(["menu/menu"],function(e){e.writeStories()})}function manageStories(){require(["menu/menu"],function(e){e.manageStories()})}function loadList(e,a){var n=$(".filter-title").val();n&&0!==n.length||(n=null);var t=$("input[name=manage_show]:checked").val(),i=$("input[name=manage_hide]:checked").val(),o=null;""!==t&&t||"Y"!==i?"Y"!==t||""!==i&&i?""!==i&&i||""!==t&&t||(o="N/A"):o="Y":o={$ne:"Y"};var r={Filter:[{Stories:{Show:o}}],Search:[{Stories:{SpeakingUrl:n}}],Limit:e||5,Offset:a||0};$.ajax({type:"POST",url:"http://aileephan.com/admin/manage/list",data:{data:JSON.stringify(r)},success:function(e){renderData(e)},error:function(e){require(["/libs/notify/toastr.min.js"],function(e){e.error("Tải truyện thất bại!","Thất bại",{timeOut:2e3})})}})}function onClickLoginFacebook(){navigator.userAgent.match("CriOS")?window.open("https://www.facebook.com/dialog/oauth?client_id=1032633966817570&redirect_uri="+document.location.href+"&scope=email,public_profile&response_type=none","",!0):FB.login(null,{scope:"email,public_profile"})}function renderData(e){if($("tbody").text(""),e&&0!==e.count&&e.rows){e.rows.forEach(function(e,a){var n='<td class="font-brand">'+(a+1+5*(currentPage-1))+"</td>",t='<td colspan="2"><h4 class="ui header"><div class="content font-header-normal">'+e.Title+"</div></h4></td>",i="Y"===e.Show?'<td class="center aligned"><div class="ui fitted slider checkbox"><input title="Cập nhật trạng thái truyện" type="checkbox" name="change-status-'+e.UID+'" onChange="onChangeShow(\''+e.UID+'\');"  checked="true"/><label></label></div></td>':'<td class="center aligned"><div class="ui fitted slider checkbox"><input title="Cập nhật trạng thái truyện" type="checkbox" name="change-status-'+e.UID+'" onChange="onChangeShow(\''+e.UID+"');\"/><label></label></div></td>",o='<td><div class="ui buttons tiny icon"><a title="Xem lại truyện" class="ui grey button font-button" onClick="onClickView(\''+e.UID+'\');"><i class="icon search"></i>Xem</a><div class="or"></div><a title="Cập nhật truyện" class="ui pink button font-button" onClick="onClickEdit(\''+e.UID+'\');"><i class="icon write"></i>Sửa</a></div></td>';$("tbody").append("<tr>"+n+t+i+o+"</tr>"),$(".manage-pagination").removeClass("hide")}),$(".manage-pagination-main").text(""),$(".manage-pagination-main").append('<a title="Trang trước" class="icon item '+(1===currentPage?"disabled":"")+'" onClick="paginationManage(\'prev\');"><i class="left chevron icon"></i></a>');var a=Math.ceil(e.count/5);totalPageCurrent=a;var n=!1,t=!1;if(1===currentPage||currentPage===a)if(1===currentPage)if(a>4){for(i=1;3>=i;i++)$(".manage-pagination-main").append('<a class="item manage-pagination-'+(i==currentPage?" active":"")+'" onClick="paginationManage('+i+');">'+i+"</a>");$(".manage-pagination-main").append('<a class="disabled item">...</a>'),$(".manage-pagination-main").append('<a class="item manage-pagination-'+(a==currentPage?" active":"")+'" onClick="paginationManage('+a+');">'+a+"</a>")}else for(i=1;a>=i;i++)$(".manage-pagination-main").append('<a class="item manage-pagination-'+(i==currentPage?" active":"")+'" onClick="paginationManage('+i+');">'+i+"</a>");else if(a>4)for($(".manage-pagination-main").append('<a class="item manage-pagination-'+(1==currentPage?" active":"")+'" onClick="paginationManage(1);">1</a>'),$(".manage-pagination-main").append('<a class="disabled item">...</a>'),i=a-2;a>=i;i++)$(".manage-pagination-main").append('<a class="item manage-pagination-'+(i==currentPage?" active":"")+'" onClick="paginationManage('+i+');">'+i+"</a>");else for(i=1;a>=i;i++)$(".manage-pagination-main").append('<a class="item manage-pagination-'+(i==currentPage?" active":"")+'" onClick="paginationManage('+i+');">'+i+"</a>");else for(var i=1;a>=i;i++)if(1!==i&&i!==a){if(n&&t)return $(".manage-pagination-main").append('<a class="item manage-pagination-'+(a==currentPage?" active":"")+'" onClick="paginationManage('+a+');">'+a+"</a>"),$(".manage-pagination-main").append('<a title="Trang sau" class="icon item '+(currentPage===a?"disabled":"")+'" onClick="paginationManage(\'next\');"><i class="right chevron icon"></i></a>'),!1;currentPage>i+1?n||($(".manage-pagination-main").append('<a class="disabled item">...</a>'),n=!0):i-1>currentPage?t||($(".manage-pagination-main").append('<a class="disabled item">...</a>'),t=!0):$(".manage-pagination-main").append('<a class="item manage-pagination-'+(i==currentPage?" active":"")+'" onClick="paginationManage('+i+');">'+i+"</a>")}else $(".manage-pagination-main").append('<a class="item manage-pagination-'+(i==currentPage?" active":"")+'" onClick="paginationManage('+i+');">'+i+"</a>");$(".manage-pagination-main").append('<a title="Trang sau" class="icon item '+(currentPage===a?"disabled":"")+'" onClick="paginationManage(\'next\');"><i class="right chevron icon"></i></a>'),$(".manage-pagination-main").removeClass("hide")}else $(".manage-pagination-main").addClass("hide");$(".manage-total").text("Tổng cộng: "+e.count+" truyện")}function paginationManage(e){if("prev"===e&&1===currentPage||"next"===e&&totalPageCurrent===currentPage)return!1;if("prev"===e){currentPage-=1;var a=5*(currentPage-1)}else if("next"===e){currentPage+=1;var a=5*(currentPage-1)}else{currentPage=e;var a=5*(currentPage-1)}loadList(5,a)}function onClickEdit(e){require(["menu/menu"],function(a){a.writeStories(e)})}function onClickView(e){require(["common/manageViewStories","/libs/notify/toastr.min.js"],function(a,n){a(e).then(function(e){if(e){var a=e.Content,t=e.Title;$(".review-description").text(""),$(".review-description").append(a),$(".review-title").text(t);var i=e&&e.FileUploads&&e.FileUploads[0]?e.FileUploads[0].UID:null;null!==i?$(".review-background").removeClass("hide"):$(".review-background").addClass("hide"),$(".review-background").attr("src","/download-background/"+i);var o=new Date;e.CreatedDate&&(o=new Date(e.CreatedDate));var r=o.getDate()<=9?"0"+o.getDate():o.getDate(),c=o.getMonth()+1<=9?"0"+(o.getMonth()+1):o.getMonth()+1,s=o.getFullYear(),l=r+"/"+c+"/"+s;$(".review-date").text(""),$(".review-date").append(l);var g=$(".ui.long.modal");g.modal({onShow:function(){setTimeout(function(){g.modal("refresh")},250)}}),g.modal("show")}else n.error("Tải truyện thất bại!","Thất bại",{timeOut:2e3})},function(e){n.error("Tải truyện thất bại!","Thất bại",{timeOut:2e3})})})}function onKeypressSearch(e){e&&13===e.keyCode&&loadList()}function onChangeShow(e){$(".confirm-change-status").val(e),$(".small.modal.change-status").modal("show")}function onClickChangeStatusNo(){var e=$(".confirm-change-status").val(),a=$("input[name=change-status-"+e+"]:checked").val();a&&0!==a.length||(a="N"),"N"===a?$("input[name=change-status-"+e+"]").prop("checked",!0):$("input[name=change-status-"+e+"]").removeAttr("checked"),$(".small.modal.change-status").modal("hide")}function onClickChangeStatusYes(){var e=$(".confirm-change-status").val();if(e&&0!==e.length){var a=$("input[name=change-status-"+e+"]:checked").val();a=a&&0!==a.length?"Y":"N",require(["common/updateStatus","/libs/notify/toastr.min.js"],function(n,t){var i={data:{Show:a,UID:e}};n(i).then(function(e){$(".small.modal.change-status").modal("hide"),t.success("Cập nhật trạng thái truyện thành công!!","Thành công",{timeOut:2e3})},function(n){"N"===a?$("input[name=change-status-"+e+"]").prop("checked",!0):$("input[name=change-status-"+e+"]").removeAttr("checked"),$(".small.modal.change-status").modal("hide"),t.error("Cập nhật trạng thái truyện thất bại!","Thất bại",{timeOut:2e3})})})}else toastr.error("Cập nhật trạng thái truyện thất bại!","Thất bại",{timeOut:2e3})}$(".connected").dropdown();var cookieAvatar=getCookie("cookieAvatar"),cookieProfile=getCookie("cookieProfile");cookieAvatar&&cookieProfile&&(cookieAvatar=JSON.parse(cookieAvatar),cookieProfile=JSON.parse(cookieProfile),cookieProfile.name&&$(".connected-name").text(cookieProfile.name),$(".connected-avatar").attr("src",cookieAvatar.url),$(".loader").removeClass("active"),$(".connected").removeClass("hide"),$(".unknown").addClass("hide"));var cookieMenu=getCookie("cookieMenu");if(cookieMenu){cookieMenu=JSON.parse(cookieMenu),$(".connected-menu").empty();var menus=null;menus=cookieMenu.isAdmin?[{Name:"Thêm mới truyện",icon:"write",func:"writeStories();"},{Name:"Quản lí truyện",icon:"book",func:"manageStories();"},{Name:"Thoát",icon:"key",func:"FB.logout();"}]:[{Name:"Thoát",icon:"key",func:"FB.logout()"}],menus.forEach(function(e,a){$(".connected-menu").append('<a class="item" onClick="'+e.func+'"><i class="'+e.icon+' icon"></i>'+e.Name+"</a>")}),$(".loader").removeClass("active"),$(".connected").removeClass("hide"),$(".unknown").addClass("hide")}define(function(e){var a=e("fbPlugin/init"),n=e("fbPlugin/login_event"),t=e("fbPlugin/logout_event"),i=e("fbPlugin/status_change");window.fbAsyncInit=function(){a(),FB.getLoginStatus(function(e){"object"==typeof e&&"connected"===e.status||($(".menu-loader").removeClass("active"),$(".connected").addClass("hide"),$(".unknown").removeClass("hide"))}),FB.Event.subscribe("auth.login",n),FB.Event.subscribe("auth.logout",t),FB.Event.subscribe("auth.statusChange",i)},function(e,a,n){var t,i=e.getElementsByTagName(a)[0];e.getElementById(n)||(t=e.createElement(a),t.id=n,t.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(t,i))}(document,"script","facebook-jssdk")});var currentPage=1,totalPageCurrent=1;